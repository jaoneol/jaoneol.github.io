---
title: Custom Response
description: Let's return Custom Response
author: DS2Man
date: 2025-04-10 11:00:00 +0000
categories: [Backend, FastAPI]
tags: [Backend, FastAPI]
math: true
pin: true
---

FastAPI uses `JSONResponse` by default to automatically convert responses into JSON. Therefore, you don't need to explicitly use `JSONResponse` for types like `dict`, `Pydantic models`, `list/tuple/set`, `datetime`, or `UUID` etc.

However, types such as HTML content, file handles, database sessions, or custom classes are not automatically serialized, so you need to use `HTMLResponse`, `FileResponse`, or handle the conversion manually.

## *Automatic JSON Conversion*

I wrote the following three sample codes. They all produce the same result depending on the type used. In fact, since FastAPI automatically converts the response to JSON, you don't need to explicitly use `JSONResponse`.

```python
import aiohttp
from aiohttp import ClientResponseError 
from pprint import pprint

async def log_response_info(response: aiohttp.ClientResponse):
    print("\n[Response Info]")
    print(f"Status       : {response.status} {response.reason}")
    print(f"URL          : {response.url}")
    print(f"Method       : {response.method}")
    print(f"Content-Type : {response.content_type}")
    print(f"Charset      : {response.charset}")
    print(f"Cookies      : {dict(response.cookies)}")
    print(f"Headers:")
    pprint(dict(response.headers))
    print(f"OK?          : {response.ok}")

    try:
        data = await response.json()
        print(f"\nJSON Body:")
        print(f"type(data): {type(data)}")
        pprint(data)
    except aiohttp.ContentTypeError:
        text = await response.text()
        print(f"\nText Body:\n{text}")

try:
    url = "http://127.0.0.1:7249/ds2man/basic/response/case1"
    async with aiohttp.ClientSession(
        trust_env=True, timeout=aiohttp.ClientTimeout(total=120)
    ) as session:
        async with session.get(url) as response:
            response.raise_for_status()
            await log_response_info(response)
except ClientResponseError as e:
        print(f"[ClientResponseError] {e.status}: {e.message}")
except Exception as e:
    print(f"[Unhandled Exception] {e}")
```

#### *Type like dict*

```python
@router.get("/response/case1")
def response_case1():
    result = {
        "user_name": "DS2Man",
        "message": "Hello, World!"
    }

    # return JSONResponse(content=result) # same result
    return result    
```

```bash
[Response Info]
Status       : 200 OK
URL          : http://127.0.0.1:7249/ds2man/basic/response/case1
Method       : GET
Content-Type : application/json
Charset      : None
Cookies      : {}
Headers:
{'Content-Length': '48',
 'Content-Type': 'application/json',
 'Date': 'Fri, 02 May 2025 20:28:14 GMT',
 'Server': 'uvicorn'}
OK?          : True

JSON Body:
type(data): <class 'dict'>
{'message': 'Hello, World!', 'user_name': 'DS2Man'}
```

#### *Pydantic models*

```python
class User(BaseModel):
    id : int
    name : str
    
@router.get("/response/case2")
def response_case2():
    result = User(id=1, name="DS2Man")

    # return JSONResponse(content=result.model_dump()) # same result
    return result
```

```bash
[Response Info]
Status       : 200 OK
URL          : http://127.0.0.1:7249/ds2man/basic/response/case2
Method       : GET
Content-Type : application/json
Charset      : None
Cookies      : {}
Headers:
{'Content-Length': '24',
 'Content-Type': 'application/json',
 'Date': 'Fri, 02 May 2025 20:28:41 GMT',
 'Server': 'uvicorn'}
OK?          : True

JSON Body:
type(data): <class 'dict'>
{'id': 1, 'name': 'DS2Man'}
```

#### *list/tuple/set*

```python
@router.get("/response/case3")
def response_case2():
    result = [User(id=1, name="DS2Man"), User(id=2, name="YongCheol")]

    # return JSONResponse(content=[user.model_dump() for user in result]) # same result
    return result
```

```bash
[Response Info]
Status       : 200 OK
URL          : http://127.0.0.1:7249/ds2man/basic/response/case3
Method       : GET
Content-Type : application/json
Charset      : None
Cookies      : {}
Headers:
{'Content-Length': '54',
 'Content-Type': 'application/json',
 'Date': 'Fri, 02 May 2025 20:29:03 GMT',
 'Server': 'uvicorn'}
OK?          : True

JSON Body:
type(data): <class 'list'>
[{'id': 1, 'name': 'DS2Man'}, {'id': 2, 'name': 'YongCheol'}]
```

## *Beyond JSON: Serving HTML, Files, and Custom Types*

FastAPI is known for its powerful automatic JSON conversion, but there are cases where you may want to return raw HTML content, perform redirections, or stream data.

Here, I’ll briefly go over a few simple examples. As the project progresses, I’ll continue to add important notes you should be aware of. For more details or if you have questions, please refer to [the official FastAPI documentation](https://fastapi.tiangolo.com/advanced/custom-response/).

#### *HTMLResponse*

```python
def generate_html_response():
    html_content = """
    <html>
        <head>
            <title>Some HTML in here</title>
        </head>
        <body>
            <h1>Look! HTML!</h1>
        </body>
    </html>
    """
    return HTMLResponse(content=html_content, status_code=200)

@router.get("/response/case4")
async def response_case4():
    return generate_html_response()
```

```bash
[Response Info]
Status       : 200 OK
URL          : http://127.0.0.1:7249/ds2man/basic/response/case4
Method       : GET
Content-Type : text/html
Charset      : utf-8
Cookies      : {}
Headers:
{'Content-Length': '171',
 'Content-Type': 'text/html; charset=utf-8',
 'Date': 'Fri, 02 May 2025 20:31:16 GMT',
 'Server': 'uvicorn'}
OK?          : True

Text Body:

    <html>
        <head>
            <title>Some HTML in here</title>
        </head>
        <body>
            <h1>Look! HTML!</h1>
        </body>
    </html>
```

#### *RedirectResponse*

```python
@router.get("/response/case5")
async def response_case5():
    redirect_url = "/ds2man/basic/response/case4"
    return RedirectResponse(redirect_url)
```

As shown in the logs below, FastAPI returns a `307 Temporary Redirect` status code, and then automatically follows the redirect to complete the request with a `200 OK`.

```bash
INFO:     127.0.0.1:7711 - "GET /ds2man/basic/response/case5 HTTP/1.1" 307 Temporary Redirect
INFO:     127.0.0.1:7711 - "GET /ds2man/basic/response/case4 HTTP/1.1" 200 OK
```

```bash
[Response Info]
Status       : 200 OK
URL          : http://127.0.0.1:7249/ds2man/basic/response/case4
Method       : GET
Content-Type : text/html
Charset      : utf-8
Cookies      : {}
Headers:
{'Content-Length': '171',
 'Content-Type': 'text/html; charset=utf-8',
 'Date': 'Fri, 02 May 2025 20:31:48 GMT',
 'Server': 'uvicorn'}
OK?          : True

Text Body:

    <html>
        <head>
            <title>Some HTML in here</title>
        </head>
        <body>
            <h1>Look! HTML!</h1>
        </body>
    </html>
```

#### *StreamingResponse*

```python
async def fake_video_streamer():
    for i in range(10):
        await sleep(0.2)
        yield b"some fake video bytes\n"
        
@router.get("/response/case6")
async def response_case6():
    return StreamingResponse(fake_video_streamer(), media_type="text/plain")
```

```python
import aiohttp
from aiohttp import ClientResponseError

async def log_response_info(response: aiohttp.ClientResponse):
    print("\n[Response Info]")
    print(f"Status       : {response.status} {response.reason}")
    print(f"URL          : {response.url}")
    print(f"Method       : {response.method}")
    print(f"Content-Type : {response.content_type}")
    print(f"Charset      : {response.charset}")
    print(f"Cookies      : {dict(response.cookies)}")
    print(f"Headers:")
    pprint(dict(response.headers))
    print(f"OK?          : {response.ok}")

async def read_streaming_response(response: aiohttp.ClientResponse):
    print("\n[Streaming Body]")
    async for chunk in response.content:
        if chunk:
            print(chunk.decode().strip(), flush=True)

try:
    url = "http://127.0.0.1:7249/ds2man/basic/response/case6"
    async with aiohttp.ClientSession(
        trust_env=True, timeout=aiohttp.ClientTimeout(total=120)
    ) as session:
        async with session.get(url) as response:
            response.raise_for_status()

            await log_response_info(response)
            await read_streaming_response(response)

except ClientResponseError as e:
    print(f"[ClientResponseError] {e.status}: {e.message}")
except Exception as e:
    print(f"[Unhandled Exception] {e}")
```

```bash
[Response Info]
Status       : 200 OK
URL          : http://127.0.0.1:7249/ds2man/basic/response/case6
Method       : GET
Content-Type : text/plain
Charset      : utf-8
Cookies      : {}
Headers:
{'Content-Type': 'text/plain; charset=utf-8',
 'Date': 'Fri, 02 May 2025 20:35:28 GMT',
 'Server': 'uvicorn',
 'Transfer-Encoding': 'chunked'}
OK?          : True

[Streaming Body]
some fake video bytes  # Printed every 0.2 seconds
some fake video bytes
some fake video bytes
some fake video bytes
some fake video bytes
some fake video bytes
some fake video bytes
some fake video bytes
some fake video bytes
some fake video bytes
```